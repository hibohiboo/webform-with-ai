# Feature Specification: アプリ感想収集フォーム

**Feature Branch**: `001-app-feedback-form`
**Created**: 2026-01-28
**Status**: Draft
**Input**: User description: "複数のアプリに対する利用者の感想を収集するためのウェブフォームを作成したい。"

## Clarifications

### Session 2026-01-28

- Q: How should apps be registered and managed in the system? → A: Apps defined in configuration file or database (managed by system administrator outside the web interface)
- Q: How should the system handle unregistered app URLs (e.g., /app999/form)? → A: Return standard 404 error page
- Q: How should the system validate and handle invalid rating values (e.g., 0, 4, text input)? → A: Accept any value and store as-is (UI guides to 1-3 but storage is flexible for future rating scale changes)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - アプリ利用者がフォームから感想を送信する (Priority: P1)

アプリの利用者として、特定のアプリについての感想を簡単に送信したい。フォームはアプリごとに異なるURLでアクセスでき、どのアプリについて回答しているかが明確に分かる必要がある。すべての入力項目は任意であり、何も入力せずに送信することも可能とする。

**Why this priority**: これはシステムの中核機能であり、利用者が感想を投稿できなければシステムの存在意義がない。この機能単独で最小限のMVPとして価値を提供できる。

**Independent Test**: 特定のアプリのフォームURL（例: /app1/form）にアクセスし、名前・評価・自由記述のいずれか、または全項目を空白のまま送信ボタンを押すことで、回答が正常に記録される。

**Acceptance Scenarios**:

1. **Given** 利用者がアプリ1のフォームURL（/app1/form）にアクセスした、**When** フォームページが表示される、**Then** ページタイトルや説明文にアプリ1の名前が表示され、どのアプリについて回答するかが明確に分かる
2. **Given** フォーム画面が表示されている、**When** 利用者が名前欄に「山田太郎」、評価欄に「2」、自由記述欄に「使いやすかった」と入力し送信ボタンを押す、**Then** 回答が正常に送信され、送信完了メッセージまたはページが表示される
3. **Given** フォーム画面が表示されている、**When** 利用者がすべての項目を空白のまま送信ボタンを押す、**Then** 回答が正常に送信され、空白の回答として記録される
4. **Given** 利用者がアプリ2のフォームURL（/app2/form）にアクセスした、**When** フォームページが表示される、**Then** ページタイトルや説明文にアプリ2の名前が表示され、アプリ1とは異なる内容が表示される

---

### User Story 2 - 管理者が回答データをCSVでダウンロードする (Priority: P2)

管理者として、収集された感想データを分析するために、すべての回答をCSV形式でダウンロードしたい。CSVには回答者の名前、評価、自由記述、回答対象のアプリ名、回答日時などが含まれる。

**Why this priority**: データを収集するだけでなく、管理者が分析できる形で取り出せることがシステムの実用性を高める。ただし、利用者が感想を送信できる機能（P1）が先に実装されている必要がある。

**Independent Test**: 管理者用のダウンロード機能にアクセスし、CSV形式のファイルをダウンロードできる。ダウンロードしたCSVをExcelやスプレッドシートで開くと、すべての回答データが正しく表示される。

**Acceptance Scenarios**:

1. **Given** システムに複数の回答データが保存されている、**When** 管理者がCSVダウンロード機能を実行する、**Then** すべての回答データを含むCSVファイルがダウンロードされる
2. **Given** ダウンロードされたCSVファイルを開いた、**When** ファイルの内容を確認する、**Then** 回答ID、アプリ名、名前、評価、自由記述、回答日時などの列が含まれており、各行に1つの回答データが記録されている
3. **Given** 一部の回答で名前や評価が未入力である、**When** CSVをダウンロードする、**Then** 未入力の項目は空白（空セル）として出力される
4. **Given** 複数のアプリに対する回答が混在している、**When** CSVをダウンロードする、**Then** すべてのアプリの回答が1つのCSVファイルにまとめられ、どのアプリに対する回答かがアプリ名列で識別できる

---

### User Story 3 - システムが将来の項目追加に対応する (Priority: P3)

システム管理者として、将来的にフォームの入力項目を追加した場合でも、過去の回答データと新しい回答データを統一的に扱いたい。過去の回答については追加された項目の値を空白として扱い、CSVダウンロード時には新しい項目の列も含まれる形で出力される。

**Why this priority**: システムの拡張性を確保する機能であり、初期リリース時には必須ではない。ただし、データ構造の設計時にこの要件を考慮しておくことで、将来の変更コストを削減できる。

**Independent Test**: フォームに新しい項目（例: 「推奨度」）を追加し、新しい回答を送信した後、CSVをダウンロードする。過去の回答には新しい項目の列が空白で表示され、新しい回答には値が入っていることを確認する。

**Acceptance Scenarios**:

1. **Given** システムに既存の回答データ（名前、評価、自由記述のみ）が保存されている、**When** フォームに新しい項目「推奨度（1〜5）」を追加し、新しい回答を送信する、**Then** 新しい回答には推奨度の値が記録される
2. **Given** 新しい項目が追加された後、**When** 管理者がCSVをダウンロードする、**Then** CSVには「推奨度」列が含まれ、過去の回答では空白、新しい回答では値が入っている
3. **Given** 複数回にわたって項目が追加されている、**When** CSVをダウンロードする、**Then** すべての項目（過去と現在）の列が含まれ、各回答は該当する項目のみに値が入り、該当しない項目は空白となる

---

### Edge Cases

- 名前や自由記述欄に特殊文字（引用符、改行、カンマなど）が含まれる場合、CSV出力時に正しくエスケープされるか？
- 同一ユーザーが同じアプリに対して複数回回答を送信した場合、すべての回答が個別に記録されるか？
- 管理者用のCSVダウンロード機能に認証やアクセス制限は必要か？（初期実装では不要、将来的に追加の可能性）
- 大量の回答データ（数千件以上）がある場合、CSVダウンロードのパフォーマンスは問題ないか？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、アプリごとに異なるURL（例: /app1/form, /app2/form）でフォームを表示できなければならない
- **FR-001-A**: アプリは、設定ファイルまたはデータベースで定義され、システム管理者がウェブインターフェース外で管理する
- **FR-002**: フォームページは、URLに基づいてアプリ名を特定し、ページタイトルや説明文にアプリ名を動的に表示しなければならない
- **FR-002-A**: 登録されていないアプリのURLにアクセスした場合、システムは標準404エラーページを返さなければならない
- **FR-003**: フォームは、名前（テキスト）、評価（1〜3の整数）、自由記述（テキストエリア）の3つの入力項目を持たなければならない
- **FR-003-A**: 評価項目のUIは1〜3の選択を誘導するが、サーバー側は任意の値を受け入れて保存する（将来的な評価段階の変更に対応するため、厳密な検証は行わない）
- **FR-004**: すべての入力項目は任意（optional）であり、利用者は何も入力せずに送信できなければならない
- **FR-005**: フォームの送信ボタンを押すと、回答データ（アプリ名、名前、評価、自由記述、送信日時など）がシステムに保存されなければならない
- **FR-006**: 管理者は、保存されたすべての回答データをCSV形式でダウンロードできなければならない
- **FR-007**: CSV出力には、回答ID、アプリ名、名前、評価、自由記述、回答日時などの列が含まれなければならない
- **FR-008**: 未入力の項目は、CSV出力時に空白（空セル）として表示されなければならない
- **FR-009**: 将来的に入力項目が追加された場合、過去の回答データについても新しい項目の列を含むCSVが出力され、該当項目が存在しない回答では空白として扱われなければならない
- **FR-010**: システムは、利用者が送信した回答を個別のレコードとして記録しなければならない（同一ユーザーの複数回答も個別に記録）

### Key Entities

- **アプリ (App)**: 回答対象となるアプリケーション。アプリID、アプリ名、フォームURLのパス部分などを持つ
- **回答 (Response)**: 利用者が送信したフォームの回答データ。回答ID、アプリID、名前、評価、自由記述、送信日時などを持つ
- **フォーム項目 (FormField)**: フォームの入力項目の定義。項目名、データ型、表示順序など。将来的な項目追加に対応するためのメタデータ
- **回答項目値 (ResponseFieldValue)**: 回答に対する各項目の値。回答IDと項目IDを紐づけ、実際の入力値を保持する（柔軟なスキーマ設計のため）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 利用者が特定のアプリのフォームURL（例: /app1/form）にアクセスしてから回答を送信するまで、1分以内に完了できる
- **SC-002**: 管理者がCSVダウンロード機能を実行してから、ファイルがダウンロード開始されるまで、5秒以内に完了する（回答数1000件以下の場合）
- **SC-003**: フォーム送信時のエラー率が5%以下である（ネットワークエラーやサーバーエラーを除く）
- **SC-004**: ダウンロードされたCSVファイルを、Excel、Google Spreadsheet、その他の表計算ソフトで問題なく開ける
- **SC-005**: 将来的に新しい項目を追加した場合でも、既存のコードの変更が最小限で済む（データモデルの柔軟性が確保されている）
